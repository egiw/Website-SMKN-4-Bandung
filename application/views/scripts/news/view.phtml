<?php
$this->MinifyHeadLink()
        ->appendStylesheet($this->baseUrl('css/application/news/view.css'));
$this->minifyHeadLink()
        ->appendStylesheet($this->baseUrl('css/application/article/view.css'));
$auth = Zend_Auth::getInstance();
?>


<?php
$permaLink = $this->url(array(
    'controller' => 'news',
    'action' => 'view',
    'module' => 'default',
    'id' => $this->news['id']));

$fullPermalink = 'http://tinyurl.com/api-create.php?url=' .$permaLink;


$tweet = "https://twitter.com/intent/tweet?source=webclient&text={$fullPermalink}";

$fullUrl = 'http://' . Zend_Controller_Front::getInstance()->getRequest()->getHttpHost() . $this->url();

?>


<div class="main row-fluid">

    <div class="span8">
        <div class="content-inner" style="margin-top: 2px;">
            <?php if ($this->news['status'] !== Admin_Model_Status::PUBLISH): ?>
                <div class="alert alert-danger">
                    Artikel ini berstatus <b><?php echo $this->news['status'] ?></b>
                    yang berarti hanya dapat dilihat oleh anda saja.
                </div>
            <?php endif; ?>
            <ul class="nav nav-pills">
                <li class="dropdown pull-right">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        Share
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                        <li>
                            <script src='http://connect.facebook.net/en_US/all.js'></script>
                            <a href="#" onclick='postToFeed(); return false;'>Facebook</a>
                            <p id='msg'>

                            </p>
                            <script> 
                                FB.init({appId:547516891937024, status: true, cookie: true});

                                function postToFeed() {

                                    // calling the API ...
                                    var obj = {
                                        method: 'feed',
                                                                              redirect_uri: '<?php echo $fullUrl; ?>',
                                                                             link: '<?php echo $fullUrl; ?>',
//                                        link : 'www.w3schools.com',
                                        picture: 'http://fbrell.com/f8.jpg',
                                                                              name: '<?php echo $this->news['title']; ?>',
                                        //name: 'haha',
                                        caption: 'Reference Documentation',
                                                                                description: '<?php echo strip_tags($this->news['content']); ?>'
                                        //description: 'haha'
                                    };

                                    function callback(response) {
                                        //                                        document.getElementById('msg').innerHTML = "Post ID: " + response['post_id'];
                                    }

                                    FB.ui(obj, callback);
                                }
    
                            </script>
                        </li>
                        <li>
                            <a id="shareTwitter" href="<?php echo $tweet ?>">Twitter</a>
                        </li>
                    </ul>
                </li>
            </ul>


            <ul class="unstyled">

                <li>

                    <h2 class="">
                        <?php echo $this->news['title'] ?>
                    </h2>
                </li>
                <li>

                    <cite>Diposting oleh : <a href="#"><b><?php echo $this->news['created_by']; ?></b></a>
                        <br />
                        <div><?php echo Date('F j, Y', strtotime($this->news['created_on'])); ?></div>
                    </cite>

                </li>

            </ul>




            <hr class="line-heading"/>

            <?php echo $this->news['content'] ?>



            <div class="clearfix"></div>

            <ul class="unstyled inline well" style="border-radius: 0;padding: 5px;">

                <li>
                    <i class="icon-eye-open"></i>
                    <?php echo $this->news['views']; ?> &nbsp;&nbsp;
                </li>
                <li>
                    <?php if ($auth->hasIdentity() && !in_array($auth->getIdentity()->username, explode(',', $this->news['likes']))): ?>
                        <a id="like-link"
                           href="<?php echo $this->url(array('action' => 'like', 'id' => $this->news['id'])); ?>"
                           title="Suka">
                            <i class="icon-thumbs-up"></i>
                            <?php echo (null != $this->news['likes'] ? count(explode(',', $this->news['likes'])) : 0); ?> &nbsp;&nbsp;
                        </a>
                    <?php else: ?>
                        <i class="icon-thumbs-up"></i>
                        <?php echo (null != $this->news['likes'] ? count(explode(',', $this->news['likes'])) : 0); ?> &nbsp;&nbsp;
                    <?php endif; ?>

                </li>
                <li>
                    <i class="icon-comments"></i>
                    <?php echo $this->comments->getTotalItemCount(); ?> &nbsp;&nbsp;
                </li>
            </ul>



            <?php if ($this->auth->hasIdentity() && $user = $this->auth->getIdentity()): ?>
                <?php
                $commentUrl = $this->url(array(
                    'action' => 'comment',
                    'controller' => 'news',
                    'module' => 'default',
                    'id' => $this->news['id'],
                    'return' => str_replace('/', '|', $this->url()) . '#comment'
                        ));
                ?>
                <form action="<?php echo $commentUrl; ?>" method="post" id="comment-form">
                    <div class="input-prepend">
                        <div class="add-on">
                            <?php
                            echo $this->thumbnail('avatar', $user->avatar, 'no-avatar.jpg'
                                    , 50, 50, 100, '');
                            ?>
                            <?php echo $this->form->submit; ?>
                        </div>
                        <?php echo $this->form->content; ?>
                    </div>
                </form>
            <?php else: ?>
                <?php
                $loginUrl = $this->url(array(
                    'controller' => 'user',
                    'action' => 'login',
                    'module' => 'admin',
                    'return' => "news|view|id|{$this->news['id']}#comment"), null, true);
                ?>
                <div class="alert">
                    <a href="#" class="close" data-dismiss="alert">&times;</a>
                    Anda harus <a href="<?php echo $loginUrl ?>">
                        Login</a> untuk memberikan komentar.
                </div>
            <?php endif; ?>

            <ul id="comment" class="media-list">
                <?php foreach ($this->comments as $index => $comment): ?>
                    <li class="media">
                        <a href="" class="pull-left">
                            <?php echo $this->thumbnail('avatar', $comment['avatar'], 'no-avatar.jpg', 50, 50, 100, ''); ?>
                        </a>
                        <div class="media-body">
                            <blockquote>
                                <p>
                                    <?php echo $comment['content']; ?>
                                </p>
                                <small>
                                    <cite><a href="#"><?php echo $comment['user']; ?></a></cite>
                                    <?php echo $this->timeSince(time() - strtotime($comment['created_on'])); ?>
                                </small>
                            </blockquote>
                        </div>
                    </li>
                <?php endforeach; ?>
            </ul>



        </div>

    </div>

    <div class="span4 sidebar well">
        <?php echo $this->render('sidebar.phtml'); ?>
    </div>
</div>

<script>


    $('#shareTwitter').click(function(event){
        event.preventDefault();
        
        var w = 700;
        var h = 500;
        var x = screen.width/2 - w/2;
        var y = screen.height/2 - h/2;
        
        window.open($(this).attr('href'),'1362073567533','width='+w+',height='+h+',toolbar=0,menubar=0,location=0,status=1,scrollbars=1,resizable=1,left='+x+',top='+y+'');return false;
    })

    
    


</script>